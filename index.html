<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAFA Loan-Based Investment Model Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fffe 0%, #ffffff 100%);
            min-height: 100vh;
            color: #1a1a1a;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 0;
        }
        
        h1 {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #22c55e, #16a34a, #15803d);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            color: #6b7280;
            font-weight: 400;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(34, 197, 94, 0.2);
            padding-bottom: 0;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: #374151;
            font-size: 0.95em;
        }
        
        .tab-button:hover {
            background: rgba(34, 197, 94, 0.1);
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(34, 197, 94, 0.1);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #22c55e;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 500;
            margin-bottom: 8px;
            color: #374151;
            font-size: 0.9em;
        }
        
        input, select {
            padding: 12px 14px;
            border: 2px solid rgba(34, 197, 94, 0.2);
            border-radius: 10px;
            font-size: 15px;
            background: rgba(255, 255, 255, 0.8);
            color: #1a1a1a;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            font-size: 16px;
            font-weight: 600;
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 15px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }
        
        .results-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.1);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-card {
            background: rgba(34, 197, 94, 0.05);
            border: 1px solid rgba(34, 197, 94, 0.2);
            padding: 18px;
            border-radius: 10px;
            text-align: center;
        }
        
        .summary-card h4 {
            margin: 0 0 8px 0;
            font-size: 0.85em;
            color: #374151;
            font-weight: 500;
        }
        
        .summary-card .value {
            font-size: 1.3em;
            font-weight: 700;
            color: #22c55e;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(34, 197, 94, 0.2);
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }
        
        th, td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid rgba(34, 197, 94, 0.1);
        }
        
        th {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td:first-child, th:first-child {
            text-align: left;
            font-weight: 600;
            color: #16a34a;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            height: 400px;
            position: relative;
        }
        
        .info-box {
            background: rgba(34, 197, 94, 0.08);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 10px;
            padding: 18px;
            margin: 15px 0;
        }
        
        .info-box h3 {
            color: #16a34a;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }
        
        .info-label {
            font-size: 0.85em;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .info-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #22c55e;
        }
        
        .hidden {
            display: none;
        }
        
        #sellingPressureChart {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>YAFA Loan-Based Investment Model</h1>
            <div class="subtitle">Collective Investment Through Business Loans</div>
        </div>
        
        <div class="tabs">
            <button class="tab-button active" id="tab-og-raise">OG $5M Raise</button>
            <button class="tab-button" id="tab-loan-main">Loan Model Main</button>
            <button class="tab-button" id="tab-investor-returns">Investor Returns</button>
            <button class="tab-button" id="tab-g2-returns">G2 Returns</button>
            <button class="tab-button" id="tab-loan-repayment">Loan Repayment</button>
            <button class="tab-button" id="tab-selling-pressure">Selling Pressure</button>
            <button class="tab-button" id="tab-yafa-impact">Yafa Net Impact</button>
        </div>
        
        <!-- OG $5M Raise Tab -->
        <div id="og-raise" class="tab-content active">
            <div class="input-section">
                <h2 class="section-title">üí∞ Original $5M Raise Model</h2>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="og-purchaseAmount">Collective Purchase Amount ($)</label>
                        <input type="number" id="og-purchaseAmount" value="5000000" min="1000000" step="100000">
                    </div>
                    <div class="input-group">
                        <label for="og-annualGrowth">Annual YAFA Growth (%)</label>
                        <input type="number" id="og-annualGrowth" value="20" min="0" max="100" step="1">
                    </div>
                    <div class="input-group">
                        <label for="og-projectionYears">Projection Years</label>
                        <input type="number" id="og-projectionYears" value="10" min="5" max="20" step="1">
                    </div>
                </div>
                
                <button class="calculate-btn" id="calculateOGBtn">Calculate OG Model</button>
            </div>
            
            <div id="og-results" class="hidden">
                <div class="results-card">
                    <h3 class="section-title">üìä OG Model Results</h3>
                    <div class="summary-grid" id="og-summary"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Token Price</th>
                                    <th>Portfolio Value</th>
                                    <th>Annual Withdrawn</th>
                                    <th>Cumulative Withdrawn</th>
                                    <th>Total Return</th>
                                </tr>
                            </thead>
                            <tbody id="og-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loan Model Main Tab -->
        <div id="loan-main" class="tab-content">
            <div class="input-section">
                <h2 class="section-title">üè¶ Loan Structure Parameters</h2>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="numInvestors">Number of Investors</label>
                        <input type="number" id="numInvestors" value="25" min="1" step="1">
                    </div>
                    <div class="input-group">
                        <label for="loanAmount">Loan Amount per Investor ($)</label>
                        <input type="number" id="loanAmount" value="300000" min="100000" step="50000">
                    </div>
                    <div class="input-group">
                        <label for="interestRate">Investor Interest Rate (%)</label>
                        <input type="number" id="interestRate" value="8" min="0" max="20" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="amortization">Amortization Period</label>
                        <select id="amortization">
                            <option value="3">3 Years</option>
                            <option value="4">4 Years</option>
                            <option value="5">5 Years</option>
                            <option value="6">6 Years</option>
                            <option value="7" selected>7 Years</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="g2Fee">G2 Global Success Fee</label>
                        <select id="g2Fee">
                            <option value="5">5%</option>
                            <option value="10" selected>10%</option>
                            <option value="15">15%</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="costPerFile">Cost per Investor File ($)</label>
                        <input type="number" id="costPerFile" value="26500" min="0" step="500">
                    </div>
                </div>
                
                <h2 class="section-title" style="margin-top: 30px;">üìà Market & Growth Parameters</h2>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="annualGrowth">Annual YAFA Growth (%)</label>
                        <input type="number" id="annualGrowth" value="20" min="0" max="100" step="1">
                    </div>
                    <div class="input-group">
                        <label for="investorWithdrawPercent">Investor Monthly Withdrawal (% of vested)</label>
                        <input type="number" id="investorWithdrawPercent" value="50" min="0" max="100" step="10">
                    </div>
                    <div class="input-group">
                        <label for="g2WithdrawPercent">G2 Monthly Withdrawal (% of vested)</label>
                        <input type="number" id="g2WithdrawPercent" value="50" min="0" max="100" step="10">
                    </div>
                    <div class="input-group">
                        <label for="projectionYears">Projection Years</label>
                        <input type="number" id="projectionYears" value="10" min="5" max="20" step="1">
                    </div>
                </div>
                
                <button class="calculate-btn" id="calculateLoanBtn">Calculate Loan Model</button>
            </div>
            
            <div id="loan-main-results" class="hidden">
                <div class="info-box">
                    <h3>Deal Structure Summary</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Total Loans</div>
                            <div class="info-value" id="totalLoans">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">G2 Success Fees</div>
                            <div class="info-value" id="g2TotalFees">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">G2 Investment (50%)</div>
                            <div class="info-value" id="g2Investment">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total to Investors</div>
                            <div class="info-value" id="totalToInvestors">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">File Management Fees</div>
                            <div class="info-value" id="fileFees">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Amount to Yafa Ltd</div>
                            <div class="info-value" id="amountToYafa">$0</div>
                        </div>
                    </div>
                    <h3 style="margin-top: 20px;">Chart Injection Breakdown</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Total Direct Chart Buys</div>
                            <div class="info-value" id="totalDirectChartBuys">$2,700,000</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">G2 + Investor Chart Buys</div>
                            <div class="info-value" id="g2InvestorChartBuys">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Yafa Chart Injection (3.5%)</div>
                            <div class="info-value" id="yafaChartInjection">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Yafa OTCs (2%)</div>
                            <div class="info-value" id="yafaOTCs">$340,000</div>
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    <h3>Token Allocation (55M Pool @ $0.50 post-injection)</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Investor Tokens (4x)</div>
                            <div class="info-value" id="investorTokens">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">G2 Tokens (4x)</div>
                            <div class="info-value" id="g2Tokens">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Yafa Tokens (Remainder)</div>
                            <div class="info-value" id="yafaTokens">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Supply Allocated</div>
                            <div class="info-value" id="totalAllocated">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Investor Returns Tab -->
        <div id="investor-returns" class="tab-content">
            <div class="results-card">
                <h3 class="section-title">üíº Individual Investor Returns ($100k Investment)</h3>
                <div class="summary-grid" id="investor-summary"></div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Tokens Held</th>
                                <th>Token Price</th>
                                <th>Portfolio Value</th>
                                <th>Annual Withdrawn</th>
                                <th>Cumulative Withdrawn</th>
                                <th>Total Return</th>
                            </tr>
                        </thead>
                        <tbody id="investor-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- G2 Returns Tab -->
        <div id="g2-returns" class="tab-content">
            <div class="results-card">
                <h3 class="section-title">ü§ù G2 Investment Returns</h3>
                <div class="summary-grid" id="g2-summary"></div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Tokens Held</th>
                                <th>Token Price</th>
                                <th>Portfolio Value</th>
                                <th>Annual Withdrawn</th>
                                <th>Cumulative Withdrawn</th>
                                <th>Total Return</th>
                            </tr>
                        </thead>
                        <tbody id="g2-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Loan Repayment Tab -->
        <div id="loan-repayment" class="tab-content">
            <div class="results-card">
                <h3 class="section-title">üìÖ Loan Repayment Schedule</h3>
                <div class="summary-grid" id="loan-summary"></div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Payment per Investor</th>
                                <th>Total Payment</th>
                                <th>Principal</th>
                                <th>Interest</th>
                                <th>Remaining Balance</th>
                            </tr>
                        </thead>
                        <tbody id="loan-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Selling Pressure Tab -->
        <div id="selling-pressure" class="tab-content">
            <div class="results-card">
                <h3 class="section-title">üìâ Total Market Selling Pressure</h3>
                <div class="chart-container">
                    <canvas id="sellingPressureChart"></canvas>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Loan Payments Required</th>
                                <th>Investor Sales</th>
                                <th>G2 Sales</th>
                                <th>Total Selling Pressure</th>
                                <th>Cumulative</th>
                            </tr>
                        </thead>
                        <tbody id="pressure-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Yafa Net Impact Tab -->
        <div id="yafa-impact" class="tab-content">
            <div class="results-card">
                <h3 class="section-title">üí∞ Yafa Ltd Net Position</h3>
                <div class="summary-grid" id="yafa-summary"></div>
                <div class="info-box">
                    <h3>Monthly Cashflow Requirements</h3>
                    <div class="info-grid" id="yafa-cashflow"></div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Yafa Token Holdings</th>
                                <th>Token Value</th>
                                <th>Annual Loan Obligations</th>
                                <th>Net Position</th>
                                <th>Cumulative Obligations Paid</th>
                            </tr>
                        </thead>
                        <tbody id="yafa-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    // Wrap everything in an IIFE to avoid global scope issues
    (function() {
        'use strict';
        
        console.log("Script starting to load...");
        
        // Constants
        const TOTAL_SUPPLY = 1000000000;
        const INITIAL_MARKET_CAP = 12460000;
        const TARGET_MARKET_CAP = 500000000;
        const POST_INJECTION_PRICE = 0.50;
        const CHART_INJECTION = 3040000;
        const VESTING_MONTHS = 72;
        const LOCK_MONTHS = 12;
        
        // Global data storage
        let loanModelData = {};
        let investorData = [];
        let g2Data = [];
        let loanSchedule = [];
        let sellingPressureData = [];
        let yafaData = [];
        let ogModelData = [];
        
        // Tab switching function
        function switchTab(tabName) {
            console.log("Switching to tab:", tabName);
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Highlight active button
            const activeButton = document.getElementById('tab-' + tabName);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }
        
        // Calculate OG Model
        function calculateOGModel() {
            console.log("Calculating OG Model...");
            
            const purchaseAmount = parseFloat(document.getElementById('og-purchaseAmount').value) || 0;
            const annualGrowth = parseFloat(document.getElementById('og-annualGrowth').value) / 100;
            const projectionYears = parseInt(document.getElementById('og-projectionYears').value);
            
            const totalRaise = 5000000;
            const tokensAvailable = 25000000;
            const collectiveTokens = (purchaseAmount / totalRaise) * tokensAvailable;
            
            ogModelData = [];
            let tokensHeld = collectiveTokens;
            let cumulativeWithdrawn = 0;
            let tokenPrice = POST_INJECTION_PRICE;
            const monthlyVesting = collectiveTokens / 60;
            
            for (let year = 1; year <= projectionYears; year++) {
                let annualWithdrawn = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const totalMonth = (year - 1) * 12 + month;
                    if (totalMonth <= 60) {
                        const monthlyWithdraw = monthlyVesting * 0.5;
                        annualWithdrawn += monthlyWithdraw * tokenPrice;
                        tokensHeld -= monthlyWithdraw;
                    }
                    tokenPrice *= (1 + annualGrowth / 12);
                }
                
                cumulativeWithdrawn += annualWithdrawn;
                
                ogModelData.push({
                    year,
                    tokenPrice,
                    portfolioValue: tokensHeld * tokenPrice,
                    annualWithdrawn,
                    cumulativeWithdrawn,
                    totalReturn: tokensHeld * tokenPrice + cumulativeWithdrawn
                });
            }
            
            displayOGResults();
        }
        
        // Display OG Results
        function displayOGResults() {
            const purchaseAmount = parseFloat(document.getElementById('og-purchaseAmount').value);
            const finalData = ogModelData[ogModelData.length - 1];
            const roi = ((finalData.totalReturn - purchaseAmount) / purchaseAmount * 100).toFixed(0);
            
            document.getElementById('og-summary').innerHTML = `
                <div class="summary-card">
                    <h4>Initial Investment</h4>
                    <div class="value">${formatCurrency(purchaseAmount)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Withdrawn</h4>
                    <div class="value">${formatCurrency(finalData.cumulativeWithdrawn)}</div>
                </div>
                <div class="summary-card">
                    <h4>Portfolio Value</h4>
                    <div class="value">${formatCurrency(finalData.portfolioValue)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Return</h4>
                    <div class="value">${formatCurrency(finalData.totalReturn)}</div>
                </div>
                <div class="summary-card">
                    <h4>ROI</h4>
                    <div class="value">${roi}%</div>
                </div>
            `;
            
            document.getElementById('og-table').innerHTML = ogModelData.map(row => `
                <tr>
                    <td>Year ${row.year}</td>
                    <td>$${row.tokenPrice.toFixed(3)}</td>
                    <td>${formatCurrency(row.portfolioValue)}</td>
                    <td>${formatCurrency(row.annualWithdrawn)}</td>
                    <td>${formatCurrency(row.cumulativeWithdrawn)}</td>
                    <td>${formatCurrency(row.totalReturn)}</td>
                </tr>
            `).join('');
            
            document.getElementById('og-results').classList.remove('hidden');
        }
        
        // Calculate Loan Model
        function calculateLoanModel() {
            console.log("Calculating Loan Model...");
            
            const numInvestors = parseInt(document.getElementById('numInvestors').value);
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);
            const interestRate = parseFloat(document.getElementById('interestRate').value) / 100;
            const amortization = parseInt(document.getElementById('amortization').value);
            const g2FeePercent = parseFloat(document.getElementById('g2Fee').value) / 100;
            const costPerFile = parseFloat(document.getElementById('costPerFile').value);
            const annualGrowth = parseFloat(document.getElementById('annualGrowth').value) / 100;
            const investorWithdrawPercent = parseFloat(document.getElementById('investorWithdrawPercent').value) / 100;
            const g2WithdrawPercent = parseFloat(document.getElementById('g2WithdrawPercent').value) / 100;
            const projectionYears = parseInt(document.getElementById('projectionYears').value);
            
            const totalLoans = numInvestors * loanAmount;
            const g2TotalFees = totalLoans * g2FeePercent;
            const g2Investment = g2TotalFees * 0.5;
            const totalToInvestors = numInvestors * 100000;
            const totalFileCosts = numInvestors * costPerFile;
            
            const totalDirectChartBuys = 2700000;
            const g2InvestorChartBuys = g2Investment + totalToInvestors;
            const yafaChartInjection = totalDirectChartBuys - g2Investment - totalToInvestors;
            const yafaOTCs = 340000;
            const amountToYafa = totalLoans - g2TotalFees - totalToInvestors - totalFileCosts;
            
            const totalTokenPool = 55000000;
            const investorTokenAllocation = (totalToInvestors * 4) / POST_INJECTION_PRICE;
            const g2TokenAllocation = (g2Investment * 4) / POST_INJECTION_PRICE;
            const yafaTokens = totalTokenPool - investorTokenAllocation - g2TokenAllocation;
            
            loanModelData = {
                numInvestors,
                loanAmount,
                interestRate,
                amortization,
                g2FeePercent,
                totalLoans,
                g2TotalFees,
                g2Investment,
                totalToInvestors,
                totalFileCosts,
                amountToYafa,
                totalDirectChartBuys,
                g2InvestorChartBuys,
                yafaChartInjection,
                yafaOTCs,
                investorTokenAllocation,
                g2TokenAllocation,
                yafaTokens,
                annualGrowth,
                investorWithdrawPercent,
                g2WithdrawPercent,
                projectionYears
            };
            
            displayLoanMainResults();
            calculateInvestorReturns();
            calculateG2Returns();
            calculateLoanRepayment();
            calculateSellingPressure();
            calculateYafaImpact();
        }
        
        // Display Loan Main Results
        function displayLoanMainResults() {
            document.getElementById('totalLoans').textContent = formatCurrency(loanModelData.totalLoans);
            document.getElementById('g2TotalFees').textContent = formatCurrency(loanModelData.g2TotalFees);
            document.getElementById('g2Investment').textContent = formatCurrency(loanModelData.g2Investment);
            document.getElementById('totalToInvestors').textContent = formatCurrency(loanModelData.totalToInvestors);
            document.getElementById('fileFees').textContent = formatCurrency(loanModelData.totalFileCosts);
            document.getElementById('amountToYafa').textContent = formatCurrency(loanModelData.amountToYafa);
            
            document.getElementById('totalDirectChartBuys').textContent = formatCurrency(loanModelData.totalDirectChartBuys);
            document.getElementById('g2InvestorChartBuys').textContent = formatCurrency(loanModelData.g2InvestorChartBuys);
            document.getElementById('yafaChartInjection').textContent = formatCurrency(loanModelData.yafaChartInjection);
            document.getElementById('yafaOTCs').textContent = formatCurrency(loanModelData.yafaOTCs);
            
            document.getElementById('investorTokens').textContent = formatNumber(loanModelData.investorTokenAllocation);
            document.getElementById('g2Tokens').textContent = formatNumber(loanModelData.g2TokenAllocation);
            document.getElementById('yafaTokens').textContent = formatNumber(loanModelData.yafaTokens);
            document.getElementById('totalAllocated').textContent = formatNumber(
                loanModelData.investorTokenAllocation + loanModelData.g2TokenAllocation + loanModelData.yafaTokens
            );
            
            document.getElementById('loan-main-results').classList.remove('hidden');
        }
        
        // Calculate Investor Returns
        function calculateInvestorReturns() {
            investorData = [];
            const tokensPerInvestor = loanModelData.investorTokenAllocation / loanModelData.numInvestors;
            let tokensHeld = tokensPerInvestor;
            let cumulativeWithdrawn = 0;
            let tokenPrice = POST_INJECTION_PRICE;
            const monthlyVesting = tokensPerInvestor / VESTING_MONTHS;
            
            for (let year = 1; year <= loanModelData.projectionYears; year++) {
                let annualWithdrawn = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const totalMonth = (year - 1) * 12 + month;
                    
                    if (totalMonth > LOCK_MONTHS && totalMonth <= (LOCK_MONTHS + VESTING_MONTHS)) {
                        const monthlyWithdraw = monthlyVesting * loanModelData.investorWithdrawPercent;
                        annualWithdrawn += monthlyWithdraw * tokenPrice;
                        tokensHeld -= monthlyWithdraw;
                    }
                    
                    tokenPrice *= (1 + loanModelData.annualGrowth / 12);
                }
                
                cumulativeWithdrawn += annualWithdrawn;
                
                investorData.push({
                    year,
                    tokensHeld,
                    tokenPrice,
                    portfolioValue: tokensHeld * tokenPrice,
                    annualWithdrawn,
                    cumulativeWithdrawn,
                    totalReturn: tokensHeld * tokenPrice + cumulativeWithdrawn
                });
            }
            
            displayInvestorReturns();
        }
        
        // Display Investor Returns
        function displayInvestorReturns() {
            const finalData = investorData[investorData.length - 1];
            const roi = ((finalData.totalReturn - 100000) / 100000 * 100).toFixed(0);
            
            document.getElementById('investor-summary').innerHTML = `
                <div class="summary-card">
                    <h4>Investment</h4>
                    <div class="value">$100,000</div>
                </div>
                <div class="summary-card">
                    <h4>Tokens Allocated (4x)</h4>
                    <div class="value">${formatNumber(loanModelData.investorTokenAllocation / loanModelData.numInvestors)}</div>
                </div>
                <div class="summary-card">
                    <h4>Final Portfolio</h4>
                    <div class="value">${formatCurrency(finalData.portfolioValue)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Withdrawn</h4>
                    <div class="value">${formatCurrency(finalData.cumulativeWithdrawn)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Return</h4>
                    <div class="value">${formatCurrency(finalData.totalReturn)}</div>
                </div>
                <div class="summary-card">
                    <h4>ROI</h4>
                    <div class="value">${roi}%</div>
                </div>
            `;
            
            document.getElementById('investor-table').innerHTML = investorData.map(row => `
                <tr>
                    <td>Year ${row.year}</td>
                    <td>${formatNumber(row.tokensHeld)}</td>
                    <td>$${row.tokenPrice.toFixed(3)}</td>
                    <td>${formatCurrency(row.portfolioValue)}</td>
                    <td>${formatCurrency(row.annualWithdrawn)}</td>
                    <td>${formatCurrency(row.cumulativeWithdrawn)}</td>
                    <td>${formatCurrency(row.totalReturn)}</td>
                </tr>
            `).join('');
        }
        
        // Calculate G2 Returns
        function calculateG2Returns() {
            g2Data = [];
            let tokensHeld = loanModelData.g2TokenAllocation;
            let cumulativeWithdrawn = 0;
            let tokenPrice = POST_INJECTION_PRICE;
            const monthlyVesting = tokensHeld / VESTING_MONTHS;
            
            for (let year = 1; year <= loanModelData.projectionYears; year++) {
                let annualWithdrawn = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const totalMonth = (year - 1) * 12 + month;
                    
                    if (totalMonth > LOCK_MONTHS && totalMonth <= (LOCK_MONTHS + VESTING_MONTHS)) {
                        const monthlyWithdraw = monthlyVesting * loanModelData.g2WithdrawPercent;
                        annualWithdrawn += monthlyWithdraw * tokenPrice;
                        tokensHeld -= monthlyWithdraw;
                    }
                    
                    tokenPrice *= (1 + loanModelData.annualGrowth / 12);
                }
                
                cumulativeWithdrawn += annualWithdrawn;
                
                g2Data.push({
                    year,
                    tokensHeld,
                    tokenPrice,
                    portfolioValue: tokensHeld * tokenPrice,
                    annualWithdrawn,
                    cumulativeWithdrawn,
                    totalReturn: tokensHeld * tokenPrice + cumulativeWithdrawn
                });
            }
            
            displayG2Returns();
        }
        
        // Display G2 Returns
        function displayG2Returns() {
            const finalData = g2Data[g2Data.length - 1];
            const roi = ((finalData.totalReturn - loanModelData.g2Investment) / loanModelData.g2Investment * 100).toFixed(0);
            
            document.getElementById('g2-summary').innerHTML = `
                <div class="summary-card">
                    <h4>G2 Investment</h4>
                    <div class="value">${formatCurrency(loanModelData.g2Investment)}</div>
                </div>
                <div class="summary-card">
                    <h4>Tokens Allocated (4x)</h4>
                    <div class="value">${formatNumber(loanModelData.g2TokenAllocation)}</div>
                </div>
                <div class="summary-card">
                    <h4>Final Portfolio</h4>
                    <div class="value">${formatCurrency(finalData.portfolioValue)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Withdrawn</h4>
                    <div class="value">${formatCurrency(finalData.cumulativeWithdrawn)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Return</h4>
                    <div class="value">${formatCurrency(finalData.totalReturn)}</div>
                </div>
                <div class="summary-card">
                    <h4>ROI</h4>
                    <div class="value">${roi}%</div>
                </div>
            `;
            
            document.getElementById('g2-table').innerHTML = g2Data.map(row => `
                <tr>
                    <td>Year ${row.year}</td>
                    <td>${formatNumber(row.tokensHeld)}</td>
                    <td>$${row.tokenPrice.toFixed(3)}</td>
                    <td>${formatCurrency(row.portfolioValue)}</td>
                    <td>${formatCurrency(row.annualWithdrawn)}</td>
                    <td>${formatCurrency(row.cumulativeWithdrawn)}</td>
                    <td>${formatCurrency(row.totalReturn)}</td>
                </tr>
            `).join('');
        }
        
        // Calculate Loan Repayment
        function calculateLoanRepayment() {
            loanSchedule = [];
            const monthlyRate = loanModelData.interestRate / 12;
            const totalMonths = loanModelData.amortization * 12;
            const loanPerInvestor = loanModelData.loanAmount;
            
            const monthlyPayment = loanPerInvestor * (monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) / 
                                   (Math.pow(1 + monthlyRate, totalMonths) - 1);
            
            let remainingBalance = loanPerInvestor * loanModelData.numInvestors;
            let totalPaid = 0;
            
            for (let month = 1; month <= totalMonths; month++) {
                const interest = remainingBalance * monthlyRate;
                const principal = (monthlyPayment * loanModelData.numInvestors) - interest;
                remainingBalance -= principal;
                totalPaid += (monthlyPayment * loanModelData.numInvestors);
                
                loanSchedule.push({
                    month,
                    paymentPerInvestor: monthlyPayment,
                    totalPayment: monthlyPayment * loanModelData.numInvestors,
                    principal,
                    interest,
                    remainingBalance: Math.max(0, remainingBalance),
                    totalPaid
                });
            }
            
            displayLoanRepayment();
        }
        
        // Display Loan Repayment
        function displayLoanRepayment() {
            const totalPayments = loanSchedule[loanSchedule.length - 1].totalPaid;
            const totalInterest = totalPayments - loanModelData.totalLoans;
            const monthlyPayment = loanSchedule[0].totalPayment;
            
            document.getElementById('loan-summary').innerHTML = `
                <div class="summary-card">
                    <h4>Total Loan Amount</h4>
                    <div class="value">${formatCurrency(loanModelData.totalLoans)}</div>
                </div>
                <div class="summary-card">
                    <h4>Monthly Payment</h4>
                    <div class="value">${formatCurrency(monthlyPayment)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Interest</h4>
                    <div class="value">${formatCurrency(totalInterest)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Payments</h4>
                    <div class="value">${formatCurrency(totalPayments)}</div>
                </div>
            `;
            
            let tableHTML = '';
            for (let i = 0; i < Math.min(12, loanSchedule.length); i++) {
                const row = loanSchedule[i];
                tableHTML += `
                    <tr>
                        <td>Month ${row.month}</td>
                        <td>${formatCurrency(row.paymentPerInvestor)}</td>
                        <td>${formatCurrency(row.totalPayment)}</td>
                        <td>${formatCurrency(row.principal)}</td>
                        <td>${formatCurrency(row.interest)}</td>
                        <td>${formatCurrency(row.remainingBalance)}</td>
                    </tr>
                `;
            }
            
            for (let year = 2; year <= loanModelData.amortization; year++) {
                const startMonth = (year - 1) * 12;
                const endMonth = Math.min(year * 12, loanSchedule.length);
                let yearPrincipal = 0, yearInterest = 0, yearPayments = 0;
                
                for (let i = startMonth; i < endMonth; i++) {
                    yearPrincipal += loanSchedule[i].principal;
                    yearInterest += loanSchedule[i].interest;
                    yearPayments += loanSchedule[i].totalPayment;
                }
                
                tableHTML += `
                    <tr style="background: rgba(34, 197, 94, 0.05);">
                        <td><strong>Year ${year} Total</strong></td>
                        <td>-</td>
                        <td>${formatCurrency(yearPayments)}</td>
                        <td>${formatCurrency(yearPrincipal)}</td>
                        <td>${formatCurrency(yearInterest)}</td>
                        <td>${formatCurrency(loanSchedule[Math.min(endMonth - 1, loanSchedule.length - 1)].remainingBalance)}</td>
                    </tr>
                `;
            }
            
            document.getElementById('loan-table').innerHTML = tableHTML;
        }
        
        // Calculate Selling Pressure
        function calculateSellingPressure() {
            sellingPressureData = [];
            let tokenPrice = POST_INJECTION_PRICE;
            const totalMonths = loanModelData.projectionYears * 12;
            
            const investorMonthlyVest = (loanModelData.investorTokenAllocation / VESTING_MONTHS);
            const g2MonthlyVest = (loanModelData.g2TokenAllocation / VESTING_MONTHS);
            
            let cumulativePressure = 0;
            
            for (let month = 1; month <= totalMonths; month++) {
                tokenPrice *= (1 + loanModelData.annualGrowth / 12);
                
                let loanPayment = 0;
                if (month <= loanSchedule.length) {
                    loanPayment = loanSchedule[month - 1].totalPayment;
                }
                
                let investorSales = 0;
                if (month > LOCK_MONTHS && month <= (LOCK_MONTHS + VESTING_MONTHS)) {
                    investorSales = investorMonthlyVest * loanModelData.investorWithdrawPercent * tokenPrice;
                }
                
                let g2Sales = 0;
                if (month > LOCK_MONTHS && month <= (LOCK_MONTHS + VESTING_MONTHS)) {
                    g2Sales = g2MonthlyVest * loanModelData.g2WithdrawPercent * tokenPrice;
                }
                
                const totalPressure = loanPayment + investorSales + g2Sales;
                cumulativePressure += totalPressure;
                
                sellingPressureData.push({
                    month,
                    loanPayment,
                    investorSales,
                    g2Sales,
                    totalPressure,
                    cumulativePressure
                });
            }
            
            displaySellingPressure();
        }
        
        // Display Selling Pressure
        function displaySellingPressure() {
            const ctx = document.getElementById('sellingPressureChart').getContext('2d');
            
            const chartLabels = [];
            const loanData = [];
            const investorDataChart = [];
            const g2DataChart = [];
            const cumulativeData = [];
            
            for (let i = 0; i < Math.min(12, sellingPressureData.length); i++) {
                chartLabels.push(`M${i + 1}`);
                loanData.push(sellingPressureData[i].loanPayment);
                investorDataChart.push(sellingPressureData[i].investorSales);
                g2DataChart.push(sellingPressureData[i].g2Sales);
                cumulativeData.push(sellingPressureData[i].cumulativePressure);
            }
            
            for (let year = 2; year <= loanModelData.projectionYears; year++) {
                const startMonth = (year - 1) * 12;
                const endMonth = Math.min(year * 12, sellingPressureData.length);
                
                let yearLoan = 0, yearInvestor = 0, yearG2 = 0;
                for (let i = startMonth; i < endMonth; i++) {
                    yearLoan += sellingPressureData[i].loanPayment;
                    yearInvestor += sellingPressureData[i].investorSales;
                    yearG2 += sellingPressureData[i].g2Sales;
                }
                
                chartLabels.push(`Y${year}`);
                loanData.push(yearLoan);
                investorDataChart.push(yearInvestor);
                g2DataChart.push(yearG2);
                cumulativeData.push(sellingPressureData[endMonth - 1].cumulativePressure);
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [
                        {
                            label: 'Loan Payments',
                            data: loanData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: 'Investor Sales',
                            data: investorDataChart,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: 'G2 Sales',
                            data: g2DataChart,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: 'Cumulative',
                            data: cumulativeData,
                            borderColor: '#22c55e',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.1,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly & Yearly Selling Pressure'
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    }
                }
            });
            
            let tableHTML = '';
            for (let i = 0; i < Math.min(12, sellingPressureData.length); i++) {
                const row = sellingPressureData[i];
                tableHTML += `
                    <tr>
                        <td>Month ${row.month}</td>
                        <td>${formatCurrency(row.loanPayment)}</td>
                        <td>${formatCurrency(row.investorSales)}</td>
                        <td>${formatCurrency(row.g2Sales)}</td>
                        <td>${formatCurrency(row.totalPressure)}</td>
                        <td>${formatCurrency(row.cumulativePressure)}</td>
                    </tr>
                `;
            }
            
            document.getElementById('pressure-table').innerHTML = tableHTML;
        }
        
        // Calculate Yafa Impact
        function calculateYafaImpact() {
            yafaData = [];
            let yafaTokens = loanModelData.yafaTokens;
            let tokenPrice = POST_INJECTION_PRICE;
            let cumulativeObligations = 0;
            
            for (let year = 1; year <= loanModelData.projectionYears; year++) {
                let annualObligations = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const totalMonth = (year - 1) * 12 + month;
                    if (totalMonth <= loanSchedule.length) {
                        annualObligations += loanSchedule[totalMonth - 1].totalPayment;
                    }
                    tokenPrice *= (1 + loanModelData.annualGrowth / 12);
                }
                
                cumulativeObligations += annualObligations;
                const tokenValue = yafaTokens * tokenPrice;
                const netPosition = tokenValue - annualObligations;
                
                yafaData.push({
                    year,
                    yafaTokens,
                    tokenPrice,
                    tokenValue,
                    annualObligations,
                    netPosition,
                    cumulativeObligations
                });
            }
            
            displayYafaImpact();
        }
        
        // Display Yafa Impact
        function displayYafaImpact() {
            const finalData = yafaData[yafaData.length - 1];
            const breakEvenMonth = findBreakEvenMonth();
            
            document.getElementById('yafa-summary').innerHTML = `
                <div class="summary-card">
                    <h4>Initial Tokens Reserved</h4>
                    <div class="value">${formatNumber(loanModelData.yafaTokens)}</div>
                </div>
                <div class="summary-card">
                    <h4>Final Token Value</h4>
                    <div class="value">${formatCurrency(finalData.tokenValue)}</div>
                </div>
                <div class="summary-card">
                    <h4>Total Obligations</h4>
                    <div class="value">${formatCurrency(finalData.cumulativeObligations)}</div>
                </div>
                <div class="summary-card">
                    <h4>Net Position</h4>
                    <div class="value">${formatCurrency(finalData.tokenValue - finalData.cumulativeObligations)}</div>
                </div>
            `;
            
            const monthlyLoanPayment = loanSchedule.length > 0 ? loanSchedule[0].totalPayment : 0;
            const peakSellingPressure = Math.max(...sellingPressureData.map(d => d.totalPressure));
            
            document.getElementById('yafa-cashflow').innerHTML = `
                <div class="info-item">
                    <div class="info-label">Monthly Loan Payment</div>
                    <div class="info-value">${formatCurrency(monthlyLoanPayment)}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Peak Monthly Pressure</div>
                    <div class="info-value">${formatCurrency(peakSellingPressure)}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Break-even Month</div>
                    <div class="info-value">${breakEvenMonth > 0 ? `Month ${breakEvenMonth}` : 'Immediate'}</div>
                </div>
            `;
            
            document.getElementById('yafa-table').innerHTML = yafaData.map(row => `
                <tr>
                    <td>Year ${row.year}</td>
                    <td>${formatNumber(row.yafaTokens)}</td>
                    <td>${formatCurrency(row.tokenValue)}</td>
                    <td>${formatCurrency(row.annualObligations)}</td>
                    <td>${formatCurrency(row.netPosition)}</td>
                    <td>${formatCurrency(row.cumulativeObligations)}</td>
                </tr>
            `).join('');
        }
        
        // Find Break Even Month
        function findBreakEvenMonth() {
            let tokenPrice = POST_INJECTION_PRICE;
            const yafaTokens = loanModelData.yafaTokens;
            
            for (let month = 1; month <= 120; month++) {
                tokenPrice *= (1 + loanModelData.annualGrowth / 12);
                const tokenValue = yafaTokens * tokenPrice;
                
                let totalObligations = 0;
                for (let i = 0; i < Math.min(month, loanSchedule.length); i++) {
                    totalObligations += loanSchedule[i].totalPayment;
                }
                
                if (tokenValue >= totalObligations) {
                    return month;
                }
            }
            
            return -1;
        }
        
        // Format Currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        // Format Number
        function formatNumber(amount) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        // Set up event listeners when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded, setting up event listeners...");
            
            // Tab buttons
            document.getElementById('tab-og-raise').addEventListener('click', function() {
                switchTab('og-raise');
            });
            
            document.getElementById('tab-loan-main').addEventListener('click', function() {
                switchTab('loan-main');
            });
            
            document.getElementById('tab-investor-returns').addEventListener('click', function() {
                switchTab('investor-returns');
            });
            
            document.getElementById('tab-g2-returns').addEventListener('click', function() {
                switchTab('g2-returns');
            });
            
            document.getElementById('tab-loan-repayment').addEventListener('click', function() {
                switchTab('loan-repayment');
            });
            
            document.getElementById('tab-selling-pressure').addEventListener('click', function() {
                switchTab('selling-pressure');
            });
            
            document.getElementById('tab-yafa-impact').addEventListener('click', function() {
                switchTab('yafa-impact');
            });
            
            // Calculate buttons
            document.getElementById('calculateOGBtn').addEventListener('click', calculateOGModel);
            document.getElementById('calculateLoanBtn').addEventListener('click', calculateLoanModel);
            
            console.log("Event listeners set up successfully!");
        });
        
        console.log("Script loaded successfully!");
        
    })();